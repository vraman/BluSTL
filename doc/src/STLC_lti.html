<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of STLC_lti</title>
  <meta name="keywords" content="STLC_lti">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">src</a> &gt; STLC_lti.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for src&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>STLC_lti
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="STLC_get_adversary.html" class="code" title="function adversary = STLC_get_adversary(Sys)">STLC_get_adversary</a>	STLC_get_adversary    constructs the controller object for the adversarial</li><li><a href="STLC_get_controller.html" class="code" title="function controller = STLC_get_controller(Sys,enc)">STLC_get_controller</a>	STLC_get_controller constructs the controller object for an STLC_lti instance</li><li><a href="STLC_lti.html" class="code" title="">STLC_lti</a>	</li><li><a href="STLC_run_adversarial.html" class="code" title="function [Sys, params] = STLC_run_adversarial(Sys, controller,adversary)">STLC_run_adversarial</a>	STLC_run_adversarial      runs a receding horizon control problem</li><li><a href="STLC_run_deterministic.html" class="code" title="function [Sys, params, rob] = STLC_run_deterministic(Sys, controller)">STLC_run_deterministic</a>	STLC_run_deterministic    runs a receding horizon control problem</li><li><a href="STLC_run_open_loop.html" class="code" title="function [Sys, params, rob] = STLC_run_open_loop(Sys, controller)">STLC_run_open_loop</a>	STLC_run_open_loop        runs an open-loop optimal control problem</li><li><a href="STLC_run_open_loop_adv.html" class="code" title="function [Sys, params] = STLC_run_open_loop_adv(Sys, controller, adversary)">STLC_run_open_loop_adv</a>	STLC_run_open_loop_adv    runs an open-loop optimal control problem</li><li><a href="STLC_sensing.html" class="code" title="function [ Wn ] = STLC_sensing( Sys )">STLC_sensing</a>	% Make data nb_stages times longer</li><li><a href="STLC_update_plot.html" class="code" title="function Sys = STLC_update_plot(Sys)">STLC_update_plot</a>	STLC_update_plot updates the plots of an STLC_lti at runtime</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="../examples/grid_system/grid_system.html" class="code" title="">grid_system</a>	</li><li><a href="../examples/hvac_room/hvac_room.html" class="code" title="">hvac_room</a>	</li><li><a href="../examples/quadrotor/quad_system.html" class="code" title="">quad_system</a>	</li><li><a href="../examples/signal_generator/signal_generator.html" class="code" title="">signal_generator</a>	</li><li><a href="../examples/simple_cars/simple_cars.html" class="code" title="">simple_cars</a>	</li><li><a href="../examples/tutorials/signal_generator.html" class="code" title="">signal_generator</a>	</li><li><a href="../examples/tutorials/tutorial1.html" class="code" title="">tutorial1</a>	% Defining the plant dynamics</li><li><a href="STLC_lti.html" class="code" title="">STLC_lti</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function Sys = STLC_lti(varargin)</a></li><li><a href="#_sub2" class="code">function [x1, y0] = system_step(Sys, x0, u0, w0)</a></li><li><a href="#_sub3" class="code">function obj = get_objective(Sys, X, Y, U,W, rho,wr)</a></li><li><a href="#_sub4" class="code">function controller = get_controller(Sys,enc)</a></li><li><a href="#_sub5" class="code">function adversary = get_adversary(Sys)</a></li><li><a href="#_sub6" class="code">function [system_data, params, rob] = run_open_loop(Sys, controller)</a></li><li><a href="#_sub7" class="code">function [Sys, params] = run_deterministic(Sys, controller)</a></li><li><a href="#_sub8" class="code">function [Sys, params] = run_open_loop_adv(Sys, controller, adversary)</a></li><li><a href="#_sub9" class="code">function [Sys, params] = run_adversarial(Sys, controller, adversary)</a></li><li><a href="#_sub10" class="code">function Sys = update_plot(Sys)</a></li><li><a href="#_sub11" class="code">function Wn = sensing(HR)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="STLC_lti.html" class="code" title="">STLC_lti</a>
0002     <span class="comment">%STLC_lti generic ABCD/ABuBwCDuDw system controller</span>
0003     <span class="comment">%</span>
0004     
0005     <span class="comment">% system properties</span>
0006     properties
0007         sys      <span class="comment">% system as control toolbox objec</span>
0008         sysd
0009         nx
0010         ny
0011         nu
0012         nw
0013         x0
0014         system_data
0015     <span class="keyword">end</span>
0016     
0017     
0018     <span class="comment">% controller properties</span>
0019     properties
0020         u_lb
0021         u_ub
0022         u_delta
0023         ts         <span class="comment">% sampling time</span>
0024         L          <span class="comment">% horizon</span>
0025         time
0026         time_d
0027         nb_stages
0028         var
0029         stl_list
0030         encoding  <span class="comment">% specifies the technique for encoding TODO</span>
0031         min_rob    <span class="comment">% TODO: if rob==0 use non robust encoding</span>
0032         lambda_rho <span class="comment">%  weight of robustness in the cost function</span>
0033         bigM
0034         solver_options
0035         model_data
0036         controller    <span class="comment">% YALMIP parametric problem for the adversary</span>
0037 
0038     <span class="keyword">end</span>
0039     
0040     <span class="comment">% adversary properties</span>
0041     properties
0042         Wref         <span class="comment">% this defines a default or initial disturbance vector</span>
0043         w_lb         <span class="comment">% lower bound on w relative to Wref</span>
0044         w_ub         <span class="comment">% upper bound on w relative to Wref</span>
0045         stl_w_list   <span class="comment">% stl properties for environment</span>
0046         max_react_iter <span class="comment">% maximum number of iterations</span>
0047         adversary    <span class="comment">% YALMIP parametric problem for the adversary</span>
0048     <span class="keyword">end</span>
0049         
0050     <span class="comment">% plotting properties</span>
0051     properties
0052         h
0053         xlabel  <span class="comment">% labels (names) for x signals</span>
0054         ylabel
0055         ulabel
0056         wlabel
0057         plot_x  <span class="comment">% indices of states to plot</span>
0058         plot_y  <span class="comment">% indices of outputs to plot</span>
0059         plot_u  <span class="comment">% index of inputs to plot</span>
0060         plot_w  <span class="comment">% index of disturbances to plot</span>
0061     <span class="keyword">end</span>
0062     
0063     <span class="comment">% misc</span>
0064     properties
0065        stop_button 
0066        verbosity 
0067     <span class="keyword">end</span>
0068     
0069     methods
0070         <a name="_sub0" href="#_subfunctions" class="code">function Sys = STLC_lti(varargin)</a>
0071             
0072             <span class="keyword">switch</span> nargin
0073                 
0074                 <span class="keyword">case</span> 2
0075                     <span class="comment">% constructor from AB system</span>
0076                     A = varargin{1};
0077                     Bu = varargin{2};
0078                     Bw = [];
0079                     C = [];
0080                     Du = [];
0081                     Dw = [];
0082                     
0083                 <span class="keyword">case</span> 3
0084                     <span class="comment">% constructor from ABuBw system</span>
0085                     A = varargin{1};
0086                     Bu = varargin{2};
0087                     Bw = varargin{3};
0088                     C = [];
0089                     Du = [];
0090                     Dw = [];
0091                     
0092                 <span class="keyword">case</span> 4
0093                     <span class="comment">% constructor from ABCD system</span>
0094                     A = varargin{1};
0095                     Bu = varargin{2};
0096                     Bw = [];
0097                     C = varargin{3};
0098                     Du = varargin{4};
0099                     Dw = [];
0100                     
0101                     <span class="comment">% constructor from ABuBwCDuDw system</span>
0102                 <span class="keyword">case</span> 6
0103                     A = varargin{1};
0104                     Bu = varargin{2};
0105                     Bw = varargin{3};
0106                     C = varargin{4};
0107                     Du = varargin{5};
0108                     Dw = varargin{6};
0109                     
0110             <span class="keyword">end</span>
0111             
0112             nx = max([size(A,1), size(Bu,1), size(Bw,1),1]);
0113             nu = max([size(Bu,2), size(Du,1)]);
0114             <span class="keyword">if</span> nu == 0
0115                 errormsg(<span class="string">'System must have at least one input (non empty Bu or Du matrix)'</span>);
0116             <span class="keyword">end</span>
0117             nw = max([size(Bw,2), size(Dw,1),1]);
0118             ny = max([size(C,1), size(Du,1), size(Dw,1),1]);
0119             
0120             <span class="comment">% default plots everything</span>
0121             Sys.plot_x = 1:max([size(A,1), size(Bu,1), size(Bw,1)]);
0122             Sys.plot_u = 1:nu;
0123             Sys.plot_y = 1:max([size(C,1), size(Du,1), size(Dw,1)]);
0124             Sys.plot_w = 1:max([size(Bw,2), size(Dw,1)]);
0125             
0126             
0127             <span class="comment">% checks empty matrices</span>
0128             <span class="keyword">if</span> isempty(A) <span class="comment">% no state</span>
0129                 A = zeros(nx,nx);
0130             <span class="keyword">end</span>
0131             
0132             <span class="keyword">if</span> isempty(Bu)
0133                 Bu = zeros(nx,nu);
0134             <span class="keyword">end</span>
0135             
0136             <span class="keyword">if</span> isempty(Bw) <span class="comment">% no disturbance</span>
0137                 Bw = zeros(nx,nw);
0138             <span class="keyword">end</span>
0139             
0140             <span class="keyword">if</span> isempty(C)
0141                 C = zeros(ny,nx);
0142             <span class="keyword">end</span>
0143             
0144             <span class="keyword">if</span> isempty(Du)
0145                 Du = zeros(ny,nu);
0146             <span class="keyword">end</span>
0147             
0148             <span class="keyword">if</span> isempty(Dw)
0149                 Dw = zeros(ny,nw);
0150             <span class="keyword">end</span>
0151             
0152             Sys.sys = ss(A,[Bu Bw],C,[Du Dw]);
0153             Sys.nx = size(A,2);
0154             Sys.nu = size(Bu,2);
0155             Sys.nw = size(Bw,2);
0156             Sys.ny = size(C,1);
0157             Sys.x0 = zeros(Sys.nx,1);
0158              
0159            
0160             <span class="comment">% default label names</span>
0161             Sys.xlabel = cell(1,nx);
0162             <span class="keyword">for</span> iX = 1:Sys.nx
0163                 Sys.xlabel{iX} = [<span class="string">'x'</span> num2str(iX)];
0164             <span class="keyword">end</span>
0165             
0166             <span class="keyword">for</span> iY = 1:Sys.ny
0167                 Sys.ylabel{iY} = [<span class="string">'y'</span> num2str(iY)];
0168             <span class="keyword">end</span>
0169             
0170             <span class="keyword">for</span> iU = 1:Sys.nu
0171                 Sys.ulabel{iU} = [<span class="string">'u'</span> num2str(iU)];
0172             <span class="keyword">end</span>
0173             
0174             <span class="keyword">for</span> iW = 1:Sys.nw
0175                 Sys.wlabel{iW} = [<span class="string">'w'</span> num2str(iW)];
0176             <span class="keyword">end</span>
0177             
0178             <span class="comment">% default options</span>
0179             Sys.solver_options = sdpsettings(<span class="string">'solver'</span>,<span class="string">'gurobi'</span>,<span class="string">'verbose'</span>,1, <span class="string">'cachesolvers'</span>,1);
0180             Sys.min_rob = 0.01;
0181             Sys.lambda_rho = 0;
0182             Sys.bigM = 1000;
0183             Sys.u_delta = Inf;
0184             Sys.max_react_iter = 10;
0185             Sys.nb_stages = 1;
0186             Sys.stop_button = 0;
0187             
0188             <span class="comment">% default values for input constraints - note, forces u to 0</span>
0189             Sys.u_lb = zeros(1,Sys.nu);
0190             Sys.u_ub = zeros(1,Sys.nu);
0191             Sys.u_delta = Inf*ones(1,Sys.nu);
0192             
0193             <span class="comment">% default values for disturbance constraints - note:w_lb and w_ub are relative to Wref</span>
0194             <span class="comment">% i.e.,   wref+w_lb  &lt;= w &lt;= wref + w_ub. Thus by default, w == Wref</span>
0195             Sys.w_lb = zeros(1,Sys.nw);
0196             Sys.w_ub = zeros(1,Sys.nw);
0197             
0198         <span class="keyword">end</span>
0199         
0200         <span class="comment">% TODO continuous-time for system step, interface to other (NL,</span>
0201         <span class="comment">% Simulink, external) dynamics)</span>
0202         <a name="_sub1" href="#_subfunctions" class="code">function [x1, y0] = system_step(Sys, x0, u0, w0)</a>
0203             x1 = Sys.sysd.A*x0+ Sys.sysd.B*[u0; w0];
0204             y0 = Sys.sysd.C*x0+ Sys.sysd.D*[u0; w0];
0205         <span class="keyword">end</span>
0206                
0207         <span class="comment">% default objective function r is the robust sat. and wr a weight</span>
0208         <a name="_sub2" href="#_subfunctions" class="code">function obj = get_objective(Sys, X, Y, U,W, rho,wr)</a>
0209             <span class="keyword">switch</span> nargin
0210                 <span class="keyword">case</span> {4,5}
0211                     obj = sum(sum(abs(U))); <span class="comment">% minimize U</span>
0212                 <span class="keyword">case</span> 6
0213                     obj = sum(sum(abs(U)))-sum(rho); <span class="comment">% minimize U penalized by r</span>
0214                 <span class="keyword">case</span> 7
0215                     obj = sum(sum(abs(U)))-wr*sum(rho);
0216             <span class="keyword">end</span>
0217         <span class="keyword">end</span>
0218       
0219         <a name="_sub3" href="#_subfunctions" class="code">function controller = get_controller(Sys,enc)</a>
0220             <span class="keyword">if</span> nargin &lt; 2
0221                 enc = <span class="string">'robust'</span>;
0222             <span class="keyword">end</span>
0223             Sys.sysd = c2d(Sys.sys, Sys.ts);
0224             controller = <a href="STLC_get_controller.html" class="code" title="function controller = STLC_get_controller(Sys,enc)">STLC_get_controller</a>(Sys,enc);
0225         <span class="keyword">end</span>
0226         
0227         <a name="_sub4" href="#_subfunctions" class="code">function adversary = get_adversary(Sys)</a>
0228             Sys.sysd = c2d(Sys.sys, Sys.ts);
0229             adversary = <a href="STLC_get_adversary.html" class="code" title="function adversary = STLC_get_adversary(Sys)">STLC_get_adversary</a>(Sys);
0230         <span class="keyword">end</span>
0231         
0232         <span class="comment">% Executes the controller in open loop mode</span>
0233         <a name="_sub5" href="#_subfunctions" class="code">function [system_data, params, rob] = run_open_loop(Sys, controller)</a>
0234             [system_data, params, rob] = <a href="STLC_run_open_loop.html" class="code" title="function [Sys, params, rob] = STLC_run_open_loop(Sys, controller)">STLC_run_open_loop</a>(Sys, controller);
0235         <span class="keyword">end</span>
0236         
0237         <span class="comment">% Executes the controller in a receding horizon (MPC)</span>
0238         <a name="_sub6" href="#_subfunctions" class="code">function [Sys, params] = run_deterministic(Sys, controller)</a>
0239             [Sys, params] = <a href="STLC_run_deterministic.html" class="code" title="function [Sys, params, rob] = STLC_run_deterministic(Sys, controller)">STLC_run_deterministic</a>(Sys, controller);
0240         <span class="keyword">end</span>
0241         
0242         <span class="comment">% Executes controller and adversary in open loop</span>
0243         <a name="_sub7" href="#_subfunctions" class="code">function [Sys, params] = run_open_loop_adv(Sys, controller, adversary)</a>
0244             [Sys, params] = <a href="STLC_run_open_loop_adv.html" class="code" title="function [Sys, params] = STLC_run_open_loop_adv(Sys, controller, adversary)">STLC_run_open_loop_adv</a>(Sys, controller, adversary);
0245         <span class="keyword">end</span>
0246         
0247         <span class="comment">% Executes controller and adversary in receding horizon mode (MPC)</span>
0248         <a name="_sub8" href="#_subfunctions" class="code">function [Sys, params] = run_adversarial(Sys, controller, adversary)</a>
0249             [Sys, params] = <a href="STLC_run_adversarial.html" class="code" title="function [Sys, params] = STLC_run_adversarial(Sys, controller,adversary)">STLC_run_adversarial</a>(Sys, controller, adversary);
0250         <span class="keyword">end</span>
0251         
0252         <span class="comment">% Default plot function</span>
0253         <a name="_sub9" href="#_subfunctions" class="code">function Sys = update_plot(Sys)</a>
0254             Sys = <a href="STLC_update_plot.html" class="code" title="function Sys = STLC_update_plot(Sys)">STLC_update_plot</a>(Sys);
0255         <span class="keyword">end</span>
0256         
0257         <a name="_sub10" href="#_subfunctions" class="code">function Wn = sensing(HR)</a>
0258                 Wn = <a href="STLC_sensing.html" class="code" title="function [ Wn ] = STLC_sensing( Sys )">STLC_sensing</a>(HR);
0259         <span class="keyword">end</span>
0260     <span class="keyword">end</span>
0261 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 09-Apr-2015 23:08:26 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>